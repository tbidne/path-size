<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">-- | @since 0.1</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PathSize</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="PathSize.Data.PathData.html#PathData"><span class="hs-identifier">PathData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="PathSize.Data.SubPathData.Internal.html#SubPathData"><span class="hs-identifier">SubPathData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.SubPathData.Internal.html#MkSubPathData"><span class="hs-identifier">MkSubPathData</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier">PathSizeResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Configuration</span></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="PathSize.Data.Config.html#Config"><span class="hs-identifier">Config</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="PathSize.Data.Config.html#Strategy"><span class="hs-identifier">Strategy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * High level functions</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="PathSize.html#findLargestPaths"><span class="hs-identifier">findLargestPaths</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="PathSize.html#pathSizeRecursive"><span class="hs-identifier">pathSizeRecursive</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="PathSize.html#pathSizeRecursiveConfig"><span class="hs-identifier">pathSizeRecursiveConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="PathSize.Data.SubPathData.Internal.html#display"><span class="hs-identifier">SPD.display</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Errors</span></span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="PathSize.Exception.html#PathE"><span class="hs-identifier">PathE</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/2g2ycicahw77sclmzzbrim691gxz10lw-unordered-containers-0.2.20-doc/share/doc/unordered-containers-0.2.20/html/src/Data.HashSet.html"><span class="hs-identifier">Data.HashSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HSet</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(:&lt;|)</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/4bf730174cbfvs5m062mx2wsg1d3picz-nonempty-containers-0.3.4.5-doc/share/doc/nonempty-containers-0.3.4.5/html/src/Data.Sequence.NonEmpty.html"><span class="hs-identifier">Data.Sequence.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/4bf730174cbfvs5m062mx2wsg1d3picz-nonempty-containers-0.3.4.5-doc/share/doc/nonempty-containers-0.3.4.5/html/src/Data.Sequence.NonEmpty.Internal.html#NESeq"><span class="hs-identifier">NESeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/4bf730174cbfvs5m062mx2wsg1d3picz-nonempty-containers-0.3.4.5-doc/share/doc/nonempty-containers-0.3.4.5/html/src/Data.Sequence.NonEmpty.Internal.html#%3A%3C%7C%7C"><span class="hs-operator">(:&lt;||)</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html"><span class="hs-identifier">Effects.Concurrent.Async</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier">MonadAsync</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html"><span class="hs-identifier">Effects.Concurrent.Async</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Async</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-exceptions-0.1-23ea7294de4bda7acf284749bdd90667bb21829c9af09afffa78e75cdeeabb46/share/doc/html/src/Effects.Exception.html"><span class="hs-identifier">Effects.Exception</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-identifier">MonadCatch</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="file:///nix/store/l0072641y03v7wfrca9v1lv596fpxxa7-safe-exceptions-0.1.7.4-doc/share/doc/safe-exceptions-0.1.7.4/html/src/Control.Exception.Safe.html#tryAny"><span class="hs-identifier">tryAny</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-utils-0.1-63291e697f80f5495c55c94c60ce67a5dc30f47d1074d2264475d78aa5752aa5/share/doc/html/src/Effects.FileSystem.OsPath.html"><span class="hs-identifier">Effects.FileSystem.OsPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OsPath</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;/&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html"><span class="hs-identifier">Effects.FileSystem.PathReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier">MonadPathReader</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html"><span class="hs-identifier">Effects.FileSystem.PathReader</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RDir</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Data.Config.html"><span class="hs-identifier">PathSize.Data.Config</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PathSize.Data.Config.html#Config"><span class="hs-identifier">Config</span></a></span><span>
</span><span id="line-42"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PathSize.Data.Config.html#MkConfig"><span class="hs-identifier">MkConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="PathSize.Data.Config.html#exclude"><span class="hs-identifier">exclude</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="PathSize.Data.Config.html#filesOnly"><span class="hs-identifier">filesOnly</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="PathSize.Data.Config.html#ignoreDirIntrinsicSize"><span class="hs-identifier">ignoreDirIntrinsicSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><a href="PathSize.Data.Config.html#maxDepth"><span class="hs-identifier">maxDepth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="PathSize.Data.Config.html#numPaths"><span class="hs-identifier">numPaths</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="PathSize.Data.Config.html#searchAll"><span class="hs-identifier">searchAll</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><a href="PathSize.Data.Config.html#stableSort"><span class="hs-identifier">stableSort</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><a href="PathSize.Data.Config.html#strategy"><span class="hs-identifier">strategy</span></a></span><span>
</span><span id="line-51"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="PathSize.Data.Config.html#Strategy"><span class="hs-identifier">Strategy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.Config.html#Async"><span class="hs-identifier">Async</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PathSize.Data.Config.html#AsyncPool"><span class="hs-identifier">AsyncPool</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PathSize.Data.Config.html#Sync"><span class="hs-identifier">Sync</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="PathSize.Data.Config.html#defaultNumPathsSize"><span class="hs-identifier">defaultNumPathsSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Data.PathData.html"><span class="hs-identifier">PathSize.Data.PathData</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PathSize.Data.PathData.html#PathData"><span class="hs-identifier">PathData</span></a></span><span>
</span><span id="line-57"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PathSize.Data.PathData.html#MkPathData"><span class="hs-identifier">MkPathData</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><a href="PathSize.Data.PathData.html#numDirectories"><span class="hs-identifier">numDirectories</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><a href="PathSize.Data.PathData.html#numFiles"><span class="hs-identifier">numFiles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><a href="PathSize.Data.PathData.html#path"><span class="hs-identifier">path</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>        </span><span class="annot"><a href="PathSize.Data.PathData.html#size"><span class="hs-identifier">size</span></a></span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Data.PathSizeResult.html"><span class="hs-identifier">PathSize.Data.PathSizeResult</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier">PathSizeResult</span></a></span><span>
</span><span id="line-66"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeFailure"><span class="hs-identifier">PathSizeFailure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizePartial"><span class="hs-identifier">PathSizePartial</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeSuccess"><span class="hs-identifier">PathSizeSuccess</span></a></span><span>
</span><span id="line-69"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#mkPathE"><span class="hs-identifier">mkPathE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Data.PathTree.html"><span class="hs-identifier">PathSize.Data.PathTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathTree.html#PathTree"><span class="hs-identifier">PathTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathTree.html#%3A%5E%7C"><span class="hs-operator">(:^|)</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Data.PathTree.html"><span class="hs-identifier">PathSize.Data.PathTree</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PathTree</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Data.SubPathData.html"><span class="hs-identifier">PathSize.Data.SubPathData</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SPD</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Data.SubPathData.Internal.html"><span class="hs-identifier">PathSize.Data.SubPathData.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.SubPathData.Internal.html#SubPathData"><span class="hs-identifier">SubPathData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.SubPathData.Internal.html#UnsafeSubPathData"><span class="hs-identifier">UnsafeSubPathData</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Exception.html"><span class="hs-identifier">PathSize.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Exception.html#PathE"><span class="hs-identifier">PathE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Exception.html#MkPathE"><span class="hs-identifier">MkPathE</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Utils.html"><span class="hs-identifier">PathSize.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Utils.html#MonadPosixC"><span class="hs-identifier">MonadPosixC</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PathSize.Utils.html"><span class="hs-identifier">PathSize.Utils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///nix/store/3782hxbhawvn3049pqvscrwhxw3aj1vw-scientific-0.3.7.0-doc/share/doc/scientific-0.3.7.0/html/src/Utils.html"><span class="hs-identifier">Utils</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.OsPath</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FP</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/jlmwgk83z11alki6v8pn6mmrx07ic0cr-unix-compat-0.7.1-doc/share/doc/unix-compat-0.7.1/html/src/System.PosixCompat.Files.html"><span class="hs-identifier">System.PosixCompat.Files</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PCompat.Files</span></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">{- HLINT ignore &quot;Redundant bracket&quot; -}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | Given a path, finds the size of all subpaths, recursively.</span><span>
</span><span id="line-85"></span><span class="hs-comment">--</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- @since 0.1</span><span>
</span><span id="line-87"></span><span id="local-6989586621679122382"><span class="annot"><a href="PathSize.html#findLargestPaths"><span class="hs-identifier hs-type">findLargestPaths</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122382"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679122382"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122382"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="PathSize.Utils.html#MonadPosixC"><span class="hs-identifier hs-type">MonadPosixC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122382"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Configuration.</span></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="PathSize.Data.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="hs-comment">-- | OsPath to search.</span></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The results.</span></span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="#local-6989586621679122382"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier hs-type">PathSizeResult</span></a></span><span> </span><span class="annot"><a href="PathSize.Data.SubPathData.Internal.html#SubPathData"><span class="hs-identifier hs-type">SubPathData</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-100"></span><span id="findLargestPaths"><span class="annot"><span class="annottext">findLargestPaths :: forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadPathReader m,
 MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult SubPathData)
</span><a href="PathSize.html#findLargestPaths"><span class="hs-identifier hs-var hs-var">findLargestPaths</span></a></span></span><span> </span><span id="local-6989586621679122554"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122554"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PathSizeResult PathTree -&gt; PathSizeResult SubPathData)
-&gt; m (PathSizeResult PathTree) -&gt; m (PathSizeResult SubPathData)
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((PathSizeResult PathTree -&gt; PathSizeResult SubPathData)
 -&gt; m (PathSizeResult PathTree) -&gt; m (PathSizeResult SubPathData))
-&gt; ((PathTree -&gt; SubPathData)
    -&gt; PathSizeResult PathTree -&gt; PathSizeResult SubPathData)
-&gt; (PathTree -&gt; SubPathData)
-&gt; m (PathSizeResult PathTree)
-&gt; m (PathSizeResult SubPathData)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PathTree -&gt; SubPathData)
-&gt; PathSizeResult PathTree -&gt; PathSizeResult SubPathData
forall a b. (a -&gt; b) -&gt; PathSizeResult a -&gt; PathSizeResult b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PathTree -&gt; SubPathData
</span><a href="#local-6989586621679122556"><span class="hs-identifier hs-var">takeLargestN</span></a></span><span> </span><span class="annot"><span class="annottext">(m (PathSizeResult PathTree) -&gt; m (PathSizeResult SubPathData))
-&gt; (OsPath -&gt; m (PathSizeResult PathTree))
-&gt; OsPath
-&gt; m (PathSizeResult SubPathData)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="#local-6989586621679122557"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122554"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621679122557"><span class="annot"><span class="annottext">f :: Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="#local-6989586621679122557"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122554"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">strategy</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><span class="annottext">Strategy
</span><a href="PathSize.Data.Config.html#Sync"><span class="hs-identifier hs-var">Sync</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
forall (m :: * -&gt; *).
(HasCallStack, MonadCatch m, MonadPathReader m, MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursiveSync"><span class="hs-identifier hs-var">pathDataRecursiveSync</span></a></span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><span class="annottext">Strategy
</span><a href="PathSize.Data.Config.html#Async"><span class="hs-identifier hs-var">Async</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadPathReader m,
 MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursiveAsync"><span class="hs-identifier hs-var">pathDataRecursiveAsync</span></a></span><span>
</span><span id="line-105"></span><span>      </span><span class="annot"><span class="annottext">Strategy
</span><a href="PathSize.Data.Config.html#AsyncPool"><span class="hs-identifier hs-var">AsyncPool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadPathReader m,
 MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursiveAsyncPool"><span class="hs-identifier hs-var">pathDataRecursiveAsyncPool</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621679122556"><span class="annot"><span class="annottext">takeLargestN :: PathTree -&gt; SubPathData
</span><a href="#local-6989586621679122556"><span class="hs-identifier hs-var hs-var">takeLargestN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><span class="annottext">(PathTree -&gt; SubPathData)
-&gt; (Positive Int -&gt; PathTree -&gt; SubPathData)
-&gt; Maybe (Positive Int)
-&gt; PathTree
-&gt; SubPathData
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-108"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; PathTree -&gt; SubPathData
</span><a href="PathSize.Data.SubPathData.Internal.html#mkSubPathData"><span class="hs-identifier hs-var">SPD.mkSubPathData</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122554"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stableSort</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Bool -&gt; Positive Int -&gt; PathTree -&gt; SubPathData
Bool -&gt; Positive Int -&gt; PathTree -&gt; SubPathData
</span><a href="PathSize.Data.SubPathData.Internal.html#takeLargestN"><span class="hs-identifier hs-var">SPD.takeLargestN</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122554"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">stableSort</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122554"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">numPaths</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="PathSize.html#findLargestPaths"><span class="hs-pragma hs-type">findLargestPaths</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | Returns the total path size in bytes. Calls 'pathSizeRecursiveConfig' with</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- the following config:</span><span>
</span><span id="line-115"></span><span class="hs-comment">--</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- MkConfig</span><span>
</span><span id="line-118"></span><span class="hs-comment">--   { searchAll = True,</span><span>
</span><span id="line-119"></span><span class="hs-comment">--     maxDepth = Just 0,</span><span>
</span><span id="line-120"></span><span class="hs-comment">--     exclude = [],</span><span>
</span><span id="line-121"></span><span class="hs-comment">--     filesOnly = False,</span><span>
</span><span id="line-122"></span><span class="hs-comment">--     ignoreDirIntrinsicSize = False,</span><span>
</span><span id="line-123"></span><span class="hs-comment">--     numPaths = Just 1,</span><span>
</span><span id="line-124"></span><span class="hs-comment">--     stableSort = False,</span><span>
</span><span id="line-125"></span><span class="hs-comment">--     strategy = Async</span><span>
</span><span id="line-126"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-128"></span><span class="hs-comment">--</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- @since 0.1</span><span>
</span><span id="line-130"></span><span id="local-6989586621679122408"><span class="annot"><a href="PathSize.html#pathSizeRecursive"><span class="hs-identifier hs-type">pathSizeRecursive</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122408"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679122408"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122408"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="PathSize.Utils.html#MonadPosixC"><span class="hs-identifier hs-type">MonadPosixC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122408"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><a href="#local-6989586621679122408"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier hs-type">PathSizeResult</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-139"></span><span id="pathSizeRecursive"><span class="annot"><span class="annottext">pathSizeRecursive :: forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadPathReader m,
 MonadPosixC m) =&gt;
OsPath -&gt; m (PathSizeResult Integer)
</span><a href="PathSize.html#pathSizeRecursive"><span class="hs-identifier hs-var hs-var">pathSizeRecursive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; OsPath -&gt; m (PathSizeResult Integer)
forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadPathReader m,
 MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult Integer)
</span><a href="PathSize.html#pathSizeRecursiveConfig"><span class="hs-identifier hs-var">pathSizeRecursiveConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122575"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679122575"><span class="annot"><span class="annottext">cfg :: Config
</span><a href="#local-6989586621679122575"><span class="hs-identifier hs-var hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>      </span><span class="annot"><a href="PathSize.Data.Config.html#MkConfig"><span class="hs-identifier hs-type">MkConfig</span></a></span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">searchAll :: Bool
</span><a href="PathSize.Data.Config.html#searchAll"><span class="hs-identifier hs-var">searchAll</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>          </span><span class="annot"><span class="annottext">maxDepth :: Maybe Word16
</span><a href="PathSize.Data.Config.html#maxDepth"><span class="hs-identifier hs-var">maxDepth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Maybe Word16
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>          </span><span class="annot"><span class="annottext">exclude :: HashSet OsPath
</span><a href="PathSize.Data.Config.html#exclude"><span class="hs-identifier hs-var">exclude</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet OsPath
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>          </span><span class="annot"><span class="annottext">filesOnly :: Bool
</span><a href="PathSize.Data.Config.html#filesOnly"><span class="hs-identifier hs-var">filesOnly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>          </span><span class="annot"><span class="annottext">ignoreDirIntrinsicSize :: Bool
</span><a href="PathSize.Data.Config.html#ignoreDirIntrinsicSize"><span class="hs-identifier hs-var">ignoreDirIntrinsicSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-148"></span><span>          </span><span class="annot"><span class="annottext">numPaths :: Maybe (Positive Int)
</span><a href="PathSize.Data.Config.html#numPaths"><span class="hs-identifier hs-var">numPaths</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Positive Int -&gt; Maybe (Positive Int)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Positive Int
</span><a href="PathSize.Data.Config.html#defaultNumPathsSize"><span class="hs-identifier hs-var">defaultNumPathsSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>          </span><span class="annot"><span class="annottext">stableSort :: Bool
</span><a href="PathSize.Data.Config.html#stableSort"><span class="hs-identifier hs-var">stableSort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>          </span><span class="annot"><span class="annottext">strategy :: Strategy
</span><a href="PathSize.Data.Config.html#strategy"><span class="hs-identifier hs-var">strategy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Strategy
</span><a href="PathSize.Data.Config.html#Async"><span class="hs-identifier hs-var">Async</span></a></span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-152"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="PathSize.html#pathSizeRecursive"><span class="hs-pragma hs-type">pathSizeRecursive</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Returns the total path size in bytes.</span><span>
</span><span id="line-155"></span><span class="hs-comment">--</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- @since 0.1</span><span>
</span><span id="line-157"></span><span id="local-6989586621679122410"><span class="annot"><a href="PathSize.html#pathSizeRecursiveConfig"><span class="hs-identifier hs-type">pathSizeRecursiveConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122410"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679122410"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122410"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="PathSize.Utils.html#MonadPosixC"><span class="hs-identifier hs-type">MonadPosixC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122410"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="PathSize.Data.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><a href="#local-6989586621679122410"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier hs-type">PathSizeResult</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-167"></span><span id="pathSizeRecursiveConfig"><span class="annot"><span class="annottext">pathSizeRecursiveConfig :: forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadPathReader m,
 MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult Integer)
</span><a href="PathSize.html#pathSizeRecursiveConfig"><span class="hs-identifier hs-var hs-var">pathSizeRecursiveConfig</span></a></span></span><span> </span><span id="local-6989586621679122600"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122600"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PathSizeResult SubPathData -&gt; PathSizeResult Integer)
-&gt; m (PathSizeResult SubPathData) -&gt; m (PathSizeResult Integer)
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((PathSizeResult SubPathData -&gt; PathSizeResult Integer)
 -&gt; m (PathSizeResult SubPathData) -&gt; m (PathSizeResult Integer))
-&gt; ((SubPathData -&gt; Integer)
    -&gt; PathSizeResult SubPathData -&gt; PathSizeResult Integer)
-&gt; (SubPathData -&gt; Integer)
-&gt; m (PathSizeResult SubPathData)
-&gt; m (PathSizeResult Integer)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SubPathData -&gt; Integer)
-&gt; PathSizeResult SubPathData -&gt; PathSizeResult Integer
forall a b. (a -&gt; b) -&gt; PathSizeResult a -&gt; PathSizeResult b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubPathData -&gt; Integer
</span><a href="#local-6989586621679122601"><span class="hs-identifier hs-var">getSize</span></a></span><span> </span><span class="annot"><span class="annottext">(m (PathSizeResult SubPathData) -&gt; m (PathSizeResult Integer))
-&gt; (OsPath -&gt; m (PathSizeResult SubPathData))
-&gt; OsPath
-&gt; m (PathSizeResult Integer)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; OsPath -&gt; m (PathSizeResult SubPathData)
forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadPathReader m,
 MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult SubPathData)
</span><a href="PathSize.html#findLargestPaths"><span class="hs-identifier hs-var">findLargestPaths</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122600"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621679122601"><span class="annot"><span class="annottext">getSize :: SubPathData -&gt; Integer
</span><a href="#local-6989586621679122601"><span class="hs-identifier hs-var hs-var">getSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.SubPathData.Internal.html#UnsafeSubPathData"><span class="hs-identifier hs-type">UnsafeSubPathData</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679122603"><span class="annot"><span class="annottext">PathData
</span><a href="#local-6989586621679122603"><span class="hs-identifier hs-var">pd</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/4bf730174cbfvs5m062mx2wsg1d3picz-nonempty-containers-0.3.4.5-doc/share/doc/nonempty-containers-0.3.4.5/html/src/Data.Sequence.NonEmpty.Internal.html#%3A%3C%7C%7C"><span class="hs-operator hs-type">:&lt;||</span></a></span><span> </span><span class="annot"><span class="annottext">Seq PathData
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PathData
</span><a href="#local-6989586621679122603"><span class="hs-identifier hs-var">pd</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">size</span><span>
</span><span id="line-170"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="PathSize.html#pathSizeRecursiveConfig"><span class="hs-pragma hs-type">pathSizeRecursiveConfig</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-comment">-- | Given a path, associates all subpaths to their size, recursively.</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- The searching is performed sequentially.</span><span>
</span><span id="line-174"></span><span class="hs-comment">--</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- @since 0.1</span><span>
</span><span id="line-176"></span><span id="local-6989586621679122404"><span class="annot"><a href="PathSize.html#pathDataRecursiveSync"><span class="hs-identifier hs-type">pathDataRecursiveSync</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679122404"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122404"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="PathSize.Utils.html#MonadPosixC"><span class="hs-identifier hs-type">MonadPosixC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122404"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><a href="PathSize.Data.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="#local-6989586621679122404"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier hs-type">PathSizeResult</span></a></span><span> </span><span class="annot"><a href="PathSize.Data.PathTree.html#PathTree"><span class="hs-identifier hs-type">PathTree</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-185"></span><span id="pathDataRecursiveSync"><span class="annot"><span class="annottext">pathDataRecursiveSync :: forall (m :: * -&gt; *).
(HasCallStack, MonadCatch m, MonadPathReader m, MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursiveSync"><span class="hs-identifier hs-var hs-var">pathDataRecursiveSync</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a b (t :: * -&gt; *).
 (HasCallStack, Traversable t) =&gt;
 (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
forall (m :: * -&gt; *).
(HasCallStack, MonadCatch m, MonadPathReader m, MonadPosixC m) =&gt;
(forall a b (t :: * -&gt; *).
 (HasCallStack, Traversable t) =&gt;
 (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursive"><span class="hs-identifier hs-var">pathDataRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall a b (t :: * -&gt; *).
(HasCallStack, Traversable t) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span>
</span><span id="line-186"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="PathSize.html#pathDataRecursiveSync"><span class="hs-pragma hs-type">pathDataRecursiveSync</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- | Like 'pathDataRecursive', but each recursive call is run in its own</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- thread.</span><span>
</span><span id="line-190"></span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- @since 0.1</span><span>
</span><span id="line-192"></span><span id="local-6989586621679122405"><span class="annot"><a href="PathSize.html#pathDataRecursiveAsync"><span class="hs-identifier hs-type">pathDataRecursiveAsync</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122405"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679122405"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122405"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="PathSize.Utils.html#MonadPosixC"><span class="hs-identifier hs-type">MonadPosixC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122405"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="PathSize.Data.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="#local-6989586621679122405"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier hs-type">PathSizeResult</span></a></span><span> </span><span class="annot"><a href="PathSize.Data.PathTree.html#PathTree"><span class="hs-identifier hs-type">PathTree</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-202"></span><span id="pathDataRecursiveAsync"><span class="annot"><span class="annottext">pathDataRecursiveAsync :: forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadPathReader m,
 MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursiveAsync"><span class="hs-identifier hs-var hs-var">pathDataRecursiveAsync</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a b (t :: * -&gt; *).
 (HasCallStack, Traversable t) =&gt;
 (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
forall (m :: * -&gt; *).
(HasCallStack, MonadCatch m, MonadPathReader m, MonadPosixC m) =&gt;
(forall a b (t :: * -&gt; *).
 (HasCallStack, Traversable t) =&gt;
 (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursive"><span class="hs-identifier hs-var">pathDataRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall a b (t :: * -&gt; *).
(HasCallStack, Traversable t) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) (t :: * -&gt; *) a b.
(MonadAsync m, Traversable t) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html#mapConcurrently"><span class="hs-identifier hs-var">Async.mapConcurrently</span></a></span><span>
</span><span id="line-203"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="PathSize.html#pathDataRecursiveAsync"><span class="hs-pragma hs-type">pathDataRecursiveAsync</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | Like 'pathDataRecursiveAsync', but runs with a thread pool.</span><span>
</span><span id="line-206"></span><span class="hs-comment">--</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- @since 0.1</span><span>
</span><span id="line-208"></span><span id="local-6989586621679122637"><span class="annot"><a href="PathSize.html#pathDataRecursiveAsyncPool"><span class="hs-identifier hs-type">pathDataRecursiveAsyncPool</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122637"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679122637"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122637"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><a href="PathSize.Utils.html#MonadPosixC"><span class="hs-identifier hs-type">MonadPosixC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122637"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><a href="PathSize.Data.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><a href="#local-6989586621679122637"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier hs-type">PathSizeResult</span></a></span><span> </span><span class="annot"><a href="PathSize.Data.PathTree.html#PathTree"><span class="hs-identifier hs-type">PathTree</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-218"></span><span id="pathDataRecursiveAsyncPool"><span class="annot"><span class="annottext">pathDataRecursiveAsyncPool :: forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadPathReader m,
 MonadPosixC m) =&gt;
Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursiveAsyncPool"><span class="hs-identifier hs-var hs-var">pathDataRecursiveAsyncPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a b (t :: * -&gt; *).
 (HasCallStack, Traversable t) =&gt;
 (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
forall (m :: * -&gt; *).
(HasCallStack, MonadCatch m, MonadPathReader m, MonadPosixC m) =&gt;
(forall a b (t :: * -&gt; *).
 (HasCallStack, Traversable t) =&gt;
 (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursive"><span class="hs-identifier hs-var">pathDataRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall a b (t :: * -&gt; *).
(HasCallStack, Traversable t) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) (t :: * -&gt; *) a b.
(MonadAsync m, HasCallStack, Traversable t) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (t :: * -&gt; *) a b.
(HasCallStack, Traversable t) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-async-0.1-7bd9a8e1dec03f566040840735ed220a5df036686fa99871d6098103d051eca6/share/doc/html/src/Effects.Concurrent.Async.html#pooledMapConcurrently"><span class="hs-identifier hs-var">Async.pooledMapConcurrently</span></a></span><span>
</span><span id="line-219"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="PathSize.html#pathDataRecursiveAsyncPool"><span class="hs-pragma hs-type">pathDataRecursiveAsyncPool</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | Given a path, associates all subpaths to their size, recursively.</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- The searching is performed via the parameter traversal.</span><span>
</span><span id="line-223"></span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- @since 0.1</span><span>
</span><span id="line-225"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="PathSize.html#pathDataRecursive"><span class="hs-pragma hs-type">pathDataRecursive</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-226"></span><span class="annot"><a href="PathSize.html#pathDataRecursive"><span class="hs-identifier hs-type">pathDataRecursive</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679122425"><span class="annot"><a href="#local-6989586621679122425"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679122425"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122425"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><a href="PathSize.Utils.html#MonadPosixC"><span class="hs-identifier hs-type">MonadPosixC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122425"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Traversal function.</span></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679122423"><span class="annot"><a href="#local-6989586621679122423"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679122424"><span class="annot"><a href="#local-6989586621679122424"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679122422"><span class="annot"><a href="#local-6989586621679122422"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversable</span></span><span> </span><span class="annot"><a href="#local-6989586621679122422"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679122423"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679122425"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122424"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679122422"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122423"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679122425"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679122422"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679122424"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The config.</span></span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><a href="PathSize.Data.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Start path.</span></span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="#local-6989586621679122425"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier hs-type">PathSizeResult</span></a></span><span> </span><span class="annot"><a href="PathSize.Data.PathTree.html#PathTree"><span class="hs-identifier hs-type">PathTree</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span id="pathDataRecursive"><span class="annot"><span class="annottext">pathDataRecursive :: forall (m :: * -&gt; *).
(HasCallStack, MonadCatch m, MonadPathReader m, MonadPosixC m) =&gt;
(forall a b (t :: * -&gt; *).
 (HasCallStack, Traversable t) =&gt;
 (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; Config -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="PathSize.html#pathDataRecursive"><span class="hs-identifier hs-var hs-var">pathDataRecursive</span></a></span></span><span> </span><span id="local-6989586621679122677"><span class="annot"><span class="annottext">forall a b (t :: * -&gt; *).
(HasCallStack, Traversable t) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="#local-6989586621679122677"><span class="hs-identifier hs-var">traverseFn</span></a></span></span><span> </span><span id="local-6989586621679122678"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122678"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Word16 -&gt; OsPath -&gt; m (PathSizeResult PathTree)
Word16 -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="#local-6989586621679122679"><span class="hs-identifier hs-var">tryGo</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679122680"><span class="annot"><span class="annottext">excluded :: HashSet OsPath
</span><a href="#local-6989586621679122680"><span class="hs-identifier hs-var hs-var">excluded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122678"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">exclude</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><a href="#local-6989586621679122681"><span class="hs-identifier hs-type">skipExcluded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-245"></span><span>    </span><span id="local-6989586621679122681"><span class="annot"><span class="annottext">skipExcluded :: OsPath -&gt; Bool
</span><a href="#local-6989586621679122681"><span class="hs-identifier hs-var hs-var">skipExcluded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OsPath -&gt; HashSet OsPath -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><a href="file:///nix/store/2g2ycicahw77sclmzzbrim691gxz10lw-unordered-containers-0.2.20-doc/share/doc/unordered-containers-0.2.20/html/src/Data.HashSet.Internal.html#member"><span class="hs-operator hs-var">`HSet.member`</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet OsPath
</span><a href="#local-6989586621679122680"><span class="hs-identifier hs-var">excluded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-comment">-- NOTE: [Directory sizes]</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621679122683"><span class="annot"><span class="annottext">dirSizeFn :: Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621679122683"><span class="hs-identifier hs-var hs-var">dirSizeFn</span></a></span></span><span>
</span><span id="line-249"></span><span>      </span><span class="hs-comment">-- filesOnly -&gt; directories are set to size 0</span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122678"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">filesOnly</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-comment">-- ignoreDirIntrinsicSize -&gt; directories are set to subfiles size;</span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-comment">-- intrinsic size of the dir itself is ignored. This relies on the</span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-comment">-- _first_ param being the subfiles size.</span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122678"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">ignoreDirIntrinsicSize</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">-- NOTE: If a maxDepth is given, we do not include paths that exceed</span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-comment">-- the depth. Note that they are still included in size calculation for</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-comment">-- parent directories.</span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621679122686"><span class="annot"><span class="annottext">depthExceeded :: Word16 -&gt; Bool
</span><a href="#local-6989586621679122686"><span class="hs-identifier hs-var hs-var">depthExceeded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122678"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">maxDepth</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="annottext">Maybe Word16
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Word16 -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679122687"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679122687"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679122687"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621679122688"><span class="annot"><span class="annottext">shouldSkip :: OsPath -&gt; Bool
</span><a href="#local-6989586621679122688"><span class="hs-identifier hs-var hs-var">shouldSkip</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679122678"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">searchAll</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashSet OsPath -&gt; Bool
forall a. HashSet a -&gt; Bool
</span><a href="file:///nix/store/2g2ycicahw77sclmzzbrim691gxz10lw-unordered-containers-0.2.20-doc/share/doc/unordered-containers-0.2.20/html/src/Data.HashSet.Internal.html#null"><span class="hs-identifier hs-var">HSet.null</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet OsPath
</span><a href="#local-6989586621679122680"><span class="hs-identifier hs-var">excluded</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-265"></span><span>      </span><span class="hs-comment">-- 1. Search all and no excluded paths: no checks</span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; OsPath -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-comment">-- 2. No search all: check hidden</span><span>
</span><span id="line-268"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; Bool
</span><a href="PathSize.Utils.html#hidden"><span class="hs-identifier hs-var">Utils.hidden</span></a></span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; Bool) -&gt; (OsPath -&gt; OsPath) -&gt; OsPath -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; OsPath
</span><span class="hs-identifier hs-var">FP.takeFileName</span></span><span>
</span><span id="line-269"></span><span>      </span><span class="hs-comment">-- 3. Some excluded paths: check excluded</span><span>
</span><span id="line-270"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; Bool
</span><a href="#local-6989586621679122681"><span class="hs-identifier hs-var">skipExcluded</span></a></span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; Bool) -&gt; (OsPath -&gt; OsPath) -&gt; OsPath -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; OsPath
</span><span class="hs-identifier hs-var">FP.takeFileName</span></span><span>
</span><span id="line-271"></span><span>      </span><span class="hs-comment">-- 4. No search all and some excluded paths: check hidden and excluded</span><span>
</span><span id="line-272"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679122692"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122692"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; Bool
</span><a href="PathSize.Utils.html#hidden"><span class="hs-identifier hs-var">Utils.hidden</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122692"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; Bool
</span><a href="#local-6989586621679122681"><span class="hs-identifier hs-var">skipExcluded</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122692"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; Bool) -&gt; (OsPath -&gt; OsPath) -&gt; OsPath -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; OsPath
</span><span class="hs-identifier hs-var">FP.takeFileName</span></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-comment">-- Base recursive function. If the path is determined to be a symlink or</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-comment">-- file, calculates the size. If it is a directory, we recursively call</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-comment">-- tryGo on all subpaths.</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="#local-6989586621679122679"><span class="hs-pragma hs-type">tryGo</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="#local-6989586621679122679"><span class="hs-identifier hs-type">tryGo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><a href="#local-6989586621679122425"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier hs-type">PathSizeResult</span></a></span><span> </span><span class="annot"><a href="PathSize.Data.PathTree.html#PathTree"><span class="hs-identifier hs-type">PathTree</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621679122679"><span class="annot"><span class="annottext">tryGo :: HasCallStack =&gt; Word16 -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="#local-6989586621679122679"><span class="hs-identifier hs-var hs-var">tryGo</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679122711"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679122711"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679122712"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122712"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><span class="annottext">m FileStatus -&gt; m (Either SomeException FileStatus)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadCatch m) =&gt;
m a -&gt; m (Either SomeException a)
</span><a href="file:///nix/store/l0072641y03v7wfrca9v1lv596fpxxa7-safe-exceptions-0.1.7.4-doc/share/doc/safe-exceptions-0.1.7.4/html/src/Control.Exception.Safe.html#tryAny"><span class="hs-identifier hs-var">tryAny</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OsPath -&gt; m FileStatus
forall (m :: * -&gt; *).
(HasCallStack, MonadPosixC m) =&gt;
OsPath -&gt; m FileStatus
</span><a href="PathSize.Utils.html#getFileStatus"><span class="hs-identifier hs-var">Utils.getFileStatus</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122712"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Either SomeException FileStatus)
-&gt; (Either SomeException FileStatus -&gt; m (PathSizeResult PathTree))
-&gt; m (PathSizeResult PathTree)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679122714"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679122714"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PathSizeResult PathTree -&gt; m (PathSizeResult PathTree)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(PathSizeResult PathTree -&gt; m (PathSizeResult PathTree))
-&gt; PathSizeResult PathTree -&gt; m (PathSizeResult PathTree)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; SomeException -&gt; PathSizeResult PathTree
forall e a. Exception e =&gt; OsPath -&gt; e -&gt; PathSizeResult a
</span><a href="PathSize.Data.PathSizeResult.html#mkPathE"><span class="hs-identifier hs-var">mkPathE</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122712"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679122714"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679122715"><span class="annot"><span class="annottext">FileStatus
</span><a href="#local-6989586621679122715"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-287"></span><span>          </span><span class="hs-comment">-- see NOTE: [Efficient Int Type]</span><span>
</span><span id="line-288"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679122716"><span class="annot"><span class="annottext">size :: Integer
</span><a href="#local-6989586621679122716"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileOffset -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(FileOffset -&gt; Integer) -&gt; FileOffset -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FileStatus -&gt; FileOffset
</span><span class="hs-identifier hs-var">PCompat.Files.fileSize</span></span><span> </span><span class="annot"><span class="annottext">FileStatus
</span><a href="#local-6989586621679122715"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="hs-comment">-- Treat all non-directories identically. getFileStatus already</span><span>
</span><span id="line-290"></span><span>          </span><span class="hs-comment">-- handles symbolic links for us (by using getSymbolicLinkStatus),</span><span>
</span><span id="line-291"></span><span>          </span><span class="hs-comment">-- There are still other file types e.g. named pipes, but I see no</span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-comment">-- reason to differentiate here i.e. the only choice we have to make</span><span>
</span><span id="line-293"></span><span>          </span><span class="hs-comment">-- is directory vs. non-directory.</span><span>
</span><span id="line-294"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FileStatus -&gt; Bool
</span><span class="hs-identifier hs-var">PCompat.Files.isDirectory</span></span><span> </span><span class="annot"><span class="annottext">FileStatus
</span><a href="#local-6989586621679122715"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-295"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
Integer -&gt; OsPath -&gt; Word16 -&gt; m (PathSizeResult PathTree)
Integer -&gt; OsPath -&gt; Word16 -&gt; m (PathSizeResult PathTree)
</span><a href="#local-6989586621679122719"><span class="hs-identifier hs-var">tryCalcDir</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679122716"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122712"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679122711"><span class="hs-identifier hs-var">depth</span></a></span><span>
</span><span id="line-296"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-297"></span><span>              </span><span class="annot"><span class="annottext">PathSizeResult PathTree -&gt; m (PathSizeResult PathTree)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(PathSizeResult PathTree -&gt; m (PathSizeResult PathTree))
-&gt; PathSizeResult PathTree -&gt; m (PathSizeResult PathTree)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-298"></span><span>                </span><span class="annot"><span class="annottext">PathTree -&gt; PathSizeResult PathTree
forall a. a -&gt; PathSizeResult a
</span><a href="PathSize.Data.PathSizeResult.html#PathSizeSuccess"><span class="hs-identifier hs-var">PathSizeSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">(PathTree -&gt; PathSizeResult PathTree)
-&gt; PathTree -&gt; PathSizeResult PathTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-299"></span><span>                  </span><span class="annot"><span class="annottext">PathData -&gt; PathTree
</span><a href="PathSize.Data.PathTree.html#singleton"><span class="hs-identifier hs-var">PathTree.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(PathData -&gt; PathTree) -&gt; PathData -&gt; PathTree
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-300"></span><span>                    </span><span class="annot"><a href="PathSize.Data.PathData.html#MkPathData"><span class="hs-identifier hs-type">MkPathData</span></a></span><span>
</span><span id="line-301"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">OsPath
path :: OsPath
path :: OsPath
</span><a href="PathSize.Data.PathData.html#path"><span class="hs-identifier hs-var hs-var">path</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>                        </span><span class="annot"><span class="annottext">Integer
size :: Integer
size :: Integer
</span><a href="PathSize.Data.PathData.html#size"><span class="hs-identifier hs-var hs-var">size</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>                        </span><span class="annot"><span class="annottext">numFiles :: Integer
</span><a href="PathSize.Data.PathData.html#numFiles"><span class="hs-identifier hs-var">numFiles</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>                        </span><span class="annot"><span class="annottext">numDirectories :: Integer
</span><a href="PathSize.Data.PathData.html#numDirectories"><span class="hs-identifier hs-var">numDirectories</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-305"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="#local-6989586621679122719"><span class="hs-pragma hs-type">tryCalcDir</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><a href="#local-6989586621679122719"><span class="hs-identifier hs-type">tryCalcDir</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-309"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-310"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-311"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-312"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-314"></span><span>      </span><span class="annot"><a href="#local-6989586621679122425"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PathSize.Data.PathSizeResult.html#PathSizeResult"><span class="hs-identifier hs-type">PathSizeResult</span></a></span><span> </span><span class="annot"><a href="PathSize.Data.PathTree.html#PathTree"><span class="hs-identifier hs-type">PathTree</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>    </span><span id="local-6989586621679122719"><span class="annot"><span class="annottext">tryCalcDir :: HasCallStack =&gt;
Integer -&gt; OsPath -&gt; Word16 -&gt; m (PathSizeResult PathTree)
</span><a href="#local-6989586621679122719"><span class="hs-identifier hs-var hs-var">tryCalcDir</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679122744"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679122744"><span class="hs-identifier hs-var">dirSize</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679122745"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122745"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679122746"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679122746"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>      </span><span class="annot"><span class="annottext">m [OsPath] -&gt; m (Either SomeException [OsPath])
forall (m :: * -&gt; *) a.
(HasCallStack, MonadCatch m) =&gt;
m a -&gt; m (Either SomeException a)
</span><a href="file:///nix/store/l0072641y03v7wfrca9v1lv596fpxxa7-safe-exceptions-0.1.7.4-doc/share/doc/safe-exceptions-0.1.7.4/html/src/Control.Exception.Safe.html#tryAny"><span class="hs-identifier hs-var">tryAny</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OsPath -&gt; Bool) -&gt; [OsPath] -&gt; [OsPath]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (OsPath -&gt; Bool) -&gt; OsPath -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; Bool
</span><a href="#local-6989586621679122688"><span class="hs-identifier hs-var">shouldSkip</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([OsPath] -&gt; [OsPath]) -&gt; m [OsPath] -&gt; m [OsPath]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m [OsPath]
forall (m :: * -&gt; *).
(MonadPathReader m, HasCallStack) =&gt;
OsPath -&gt; m [OsPath]
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.8.2/effects-fs-0.1-2a8d846f4d0ecfeeea39f98df1e38e7a40a3401936297a98d908b10fdb6c87db/share/doc/html/src/Effects.FileSystem.PathReader.html#listDirectory"><span class="hs-identifier hs-var">RDir.listDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122745"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Either SomeException [OsPath])
-&gt; (Either SomeException [OsPath] -&gt; m (PathSizeResult PathTree))
-&gt; m (PathSizeResult PathTree)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679122750"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679122750"><span class="hs-identifier hs-var">listDirEx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PathSizeResult PathTree -&gt; m (PathSizeResult PathTree)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(PathSizeResult PathTree -&gt; m (PathSizeResult PathTree))
-&gt; PathSizeResult PathTree -&gt; m (PathSizeResult PathTree)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; SomeException -&gt; PathSizeResult PathTree
forall e a. Exception e =&gt; OsPath -&gt; e -&gt; PathSizeResult a
</span><a href="PathSize.Data.PathSizeResult.html#mkPathE"><span class="hs-identifier hs-var">mkPathE</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122745"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679122750"><span class="hs-identifier hs-var">listDirEx</span></a></span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679122751"><span class="annot"><span class="annottext">[OsPath]
</span><a href="#local-6989586621679122751"><span class="hs-identifier hs-var">subPaths</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>          </span><span id="local-6989586621679122752"><span class="annot"><span class="annottext">Seq (PathSizeResult PathTree)
</span><a href="#local-6989586621679122752"><span class="hs-identifier hs-var">resultSubTrees</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-320"></span><span>            </span><span class="annot"><span class="annottext">(OsPath -&gt; m (PathSizeResult PathTree))
-&gt; Seq OsPath -&gt; m (Seq (PathSizeResult PathTree))
forall a b (t :: * -&gt; *).
(HasCallStack, Traversable t) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="#local-6989586621679122677"><span class="hs-identifier hs-var">traverseFn</span></a></span><span>
</span><span id="line-321"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Word16 -&gt; OsPath -&gt; m (PathSizeResult PathTree)
Word16 -&gt; OsPath -&gt; m (PathSizeResult PathTree)
</span><a href="#local-6989586621679122679"><span class="hs-identifier hs-var">tryGo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679122746"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Word16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; m (PathSizeResult PathTree))
-&gt; (OsPath -&gt; OsPath) -&gt; OsPath -&gt; m (PathSizeResult PathTree)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679122745"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-operator">&lt;/&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OsPath] -&gt; Seq OsPath
forall a. [a] -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.fromList</span></span><span> </span><span class="annot"><span class="annottext">[OsPath]
</span><a href="#local-6989586621679122751"><span class="hs-identifier hs-var">subPaths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679122754"><span class="annot"><span class="annottext">Seq PathE
</span><a href="#local-6989586621679122754"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679122755"><span class="annot"><span class="annottext">Seq PathTree
</span><a href="#local-6989586621679122755"><span class="hs-identifier hs-var">subTrees</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq (PathSizeResult PathTree) -&gt; (Seq PathE, Seq PathTree)
</span><a href="PathSize.Utils.html#unzipResultSeq"><span class="hs-identifier hs-var">Utils.unzipResultSeq</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (PathSizeResult PathTree)
</span><a href="#local-6989586621679122752"><span class="hs-identifier hs-var">resultSubTrees</span></a></span><span>
</span><span id="line-325"></span><span>              </span><span class="hs-special">(#</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679122757"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679122757"><span class="hs-identifier hs-var">subSize</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679122758"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679122758"><span class="hs-identifier hs-var">numFiles</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679122759"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679122759"><span class="hs-identifier hs-var">subDirs</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq PathTree -&gt; (# Integer, Integer, Integer #)
</span><a href="PathSize.Data.PathTree.html#sumTrees"><span class="hs-identifier hs-var">PathTree.sumTrees</span></a></span><span> </span><span class="annot"><span class="annottext">Seq PathTree
</span><a href="#local-6989586621679122755"><span class="hs-identifier hs-var">subTrees</span></a></span><span>
</span><span id="line-326"></span><span>              </span><span class="hs-glyph">!</span><span id="local-6989586621679122761"><span class="annot"><span class="annottext">numDirectories :: Integer
</span><a href="#local-6989586621679122761"><span class="hs-identifier hs-var hs-var">numDirectories</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679122759"><span class="hs-identifier hs-var">subDirs</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-327"></span><span>              </span><span class="hs-comment">-- NOTE: subSize needs to be the first param to corrrectly</span><span>
</span><span id="line-328"></span><span>              </span><span class="hs-comment">-- account for ignoreDirIntrinsicSize.</span><span>
</span><span id="line-329"></span><span>              </span><span class="hs-comment">-- See NOTE: [Directory sizes]</span><span>
</span><span id="line-330"></span><span>              </span><span class="hs-glyph">!</span><span id="local-6989586621679122762"><span class="annot"><span class="annottext">size :: Integer
</span><a href="#local-6989586621679122762"><span class="hs-identifier hs-var hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621679122683"><span class="hs-identifier hs-var">dirSizeFn</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679122757"><span class="hs-identifier hs-var">subSize</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679122744"><span class="hs-identifier hs-var">dirSize</span></a></span><span>
</span><span id="line-331"></span><span>              </span><span class="hs-comment">-- Do not report subpaths if the depth is exceeded.</span><span>
</span><span id="line-332"></span><span>              </span><span id="local-6989586621679122763"><span class="annot"><span class="annottext">subTrees' :: Seq PathTree
</span><a href="#local-6989586621679122763"><span class="hs-identifier hs-var hs-var">subTrees'</span></a></span></span><span>
</span><span id="line-333"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Bool
</span><a href="#local-6989586621679122686"><span class="hs-identifier hs-var">depthExceeded</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679122746"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq PathTree
forall a. Seq a
</span><span class="hs-identifier hs-var">Empty</span></span><span>
</span><span id="line-334"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq PathTree
</span><a href="#local-6989586621679122755"><span class="hs-identifier hs-var">subTrees</span></a></span><span>
</span><span id="line-335"></span><span>              </span><span id="local-6989586621679122764"><span class="annot"><span class="annottext">tree :: PathTree
</span><a href="#local-6989586621679122764"><span class="hs-identifier hs-var hs-var">tree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-336"></span><span>                </span><span class="annot"><a href="PathSize.Data.PathData.html#MkPathData"><span class="hs-identifier hs-type">MkPathData</span></a></span><span>
</span><span id="line-337"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">OsPath
path :: OsPath
path :: OsPath
</span><a href="PathSize.Data.PathData.html#path"><span class="hs-identifier hs-var hs-var">path</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-338"></span><span>                    </span><span class="annot"><span class="annottext">Integer
size :: Integer
size :: Integer
</span><a href="PathSize.Data.PathData.html#size"><span class="hs-identifier hs-var hs-var">size</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-339"></span><span>                    </span><span class="annot"><span class="annottext">Integer
numFiles :: Integer
numFiles :: Integer
</span><a href="PathSize.Data.PathData.html#numFiles"><span class="hs-identifier hs-var hs-var">numFiles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-340"></span><span>                    </span><span class="annot"><span class="annottext">Integer
numDirectories :: Integer
numDirectories :: Integer
</span><a href="PathSize.Data.PathData.html#numDirectories"><span class="hs-identifier hs-var hs-var">numDirectories</span></a></span><span>
</span><span id="line-341"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-342"></span><span>                  </span><span class="annot"><span class="annottext">PathData -&gt; Seq PathTree -&gt; PathTree
</span><a href="PathSize.Data.PathTree.html#%3A%5E%7C"><span class="hs-operator hs-var">:^|</span></a></span><span> </span><span class="annot"><span class="annottext">Seq PathTree
</span><a href="#local-6989586621679122763"><span class="hs-identifier hs-var">subTrees'</span></a></span><span>
</span><span id="line-343"></span><span>          </span><span class="annot"><span class="annottext">PathSizeResult PathTree -&gt; m (PathSizeResult PathTree)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(PathSizeResult PathTree -&gt; m (PathSizeResult PathTree))
-&gt; PathSizeResult PathTree -&gt; m (PathSizeResult PathTree)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Seq PathE
</span><a href="#local-6989586621679122754"><span class="hs-identifier hs-var">errs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-344"></span><span>            </span><span class="annot"><span class="annottext">Seq PathE
</span><span class="hs-identifier hs-var">Empty</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PathTree -&gt; PathSizeResult PathTree
forall a. a -&gt; PathSizeResult a
</span><a href="PathSize.Data.PathSizeResult.html#PathSizeSuccess"><span class="hs-identifier hs-var">PathSizeSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">PathTree
</span><a href="#local-6989586621679122764"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-345"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679122765"><span class="annot"><span class="annottext">PathE
</span><a href="#local-6989586621679122765"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|</span></span><span> </span><span id="local-6989586621679122766"><span class="annot"><span class="annottext">Seq PathE
</span><a href="#local-6989586621679122766"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NESeq PathE -&gt; PathTree -&gt; PathSizeResult PathTree
forall a. NESeq PathE -&gt; a -&gt; PathSizeResult a
</span><a href="PathSize.Data.PathSizeResult.html#PathSizePartial"><span class="hs-identifier hs-var">PathSizePartial</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathE
</span><a href="#local-6989586621679122765"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">PathE -&gt; Seq PathE -&gt; NESeq PathE
forall a. a -&gt; Seq a -&gt; NESeq a
</span><a href="file:///nix/store/4bf730174cbfvs5m062mx2wsg1d3picz-nonempty-containers-0.3.4.5-doc/share/doc/nonempty-containers-0.3.4.5/html/src/Data.Sequence.NonEmpty.Internal.html#%3A%3C%7C%7C"><span class="hs-operator hs-var">:&lt;||</span></a></span><span> </span><span class="annot"><span class="annottext">Seq PathE
</span><a href="#local-6989586621679122766"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PathTree
</span><a href="#local-6989586621679122764"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-346"></span></pre></body></html>